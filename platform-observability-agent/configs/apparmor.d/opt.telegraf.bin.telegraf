# Last Modified: Tue Feb  6 15:44:45 2024
abi <abi/3.0>,

include <tunables/global>

/opt/telegraf/bin/telegraf {
  include <abstractions/base>
  include <abstractions/bash>
  include <abstractions/dri-common>

  capability audit_write,
  capability dac_override,
  capability dac_read_search,
  capability perfmon,
  capability setgid,
  capability setuid,
  capability sys_admin,
  capability sys_rawio,
  capability sys_resource,

  network inet dgram,
  network inet stream,
  network inet6 dgram,
  network netlink raw,

  ptrace read,

  /dev/ r,
  /dev/cpu/**/msr r,
  /dev/dm-* r,
  /dev/ipmi0 rw,
  /dev/loop* r,
  /dev/megaraid_sas_ioctl_node rw,
  /dev/mapper/control rw,
  /dev/nvme0 r,
  /dev/sd* r,
  /dev/tty rw,
  /etc/default/locale r,
  /etc/edge-node/node/confs/platform-observability-metrics ix,
  /etc/environment r,
  /etc/group r,
  /etc/host.conf r,
  /etc/hosts r,
  /etc/login.defs r,
  /etc/lvm/archive/ r,
  /etc/lvm/archive/** rwk,
  /etc/lvm/backup/ r,
  /etc/lvm/backup/** rwk,
  /etc/lvm/lvm.conf r,
  /etc/lvm/lvmlocal.conf r,
  /etc/nsswitch.conf r,
  /etc/pam.d/common-account r,
  /etc/pam.d/common-auth r,
  /etc/pam.d/common-password r,
  /etc/pam.d/common-session r,
  /etc/pam.d/common-session-noninteractive r,
  /etc/pam.d/other r,
  /etc/pam.d/sudo r,
  /etc/passwd r,
  /etc/protocols r,
  /etc/security/capability.conf r,
  /etc/security/limits.conf r,
  /etc/security/limits.d/ r,
  /etc/security/pam_env.conf r,
  /etc/services r,
  /etc/shadow r,
  /etc/sudo.conf r,
  /etc/sudoers r,
  /etc/sudoers.d/ r,
  /etc/sudoers.d/** r,
  /etc/telegraf/pmu-events/** r,
  /etc/telegraf/telegraf.d/poa-telegraf.conf r,
  /opt/telegraf/** rw,
  /opt/telegraf/bin/collect_disk_info.sh ix,
  /opt/telegraf/bin/collect_gpu_metrics.sh mrix,
  /opt/telegraf/bin/core_metrics.sh mrix,
  /opt/telegraf/bin/telegraf mrix,
  /proc/ r,
  /proc/** r,
  /run/lock/lvm/P_global rwk,
  /run/lock/lvm/P_global:aux rwk,
  /run/lock/lvm/V_lvmvg rwk,
  /run/lock/lvm/V_lvmvg:aux rwk,
  /run/lvm/hints rwk,
  /run/lvm/newhints rw,
  /run/platform-observability-agent/platform-observability-agent.sock rw,
  /run/sudo/ts/platform-observability-agent rwk,
  /run/systemd/resolve/stub-resolv.conf r,
  /run/systemd/userdb r,
  /run/udev/data/** r,
  /run/utmp r,
  /sys/block/ r,
  /sys/class/hwmon/ r,
  /sys/class/scsi_host/ r,
  /sys/class/thermal/ r,
  /sys/devices/ r,
  /sys/devices/** r,
  /sys/firmware/dmi/tables/DMI r,
  /sys/kernel/mm/transparent_hugepage/hpage_pmd_size r,
  /usr/bin/cut mrix,
  /usr/bin/cat ix,
  /usr/bin/dash ix,
  /usr/bin/df ix,
  /usr/bin/dpkg mrix,
  /usr/bin/echo ix,
  /usr/bin/grep mrix,
  /usr/bin/ipmitool ix,
  /usr/bin/jq mrix,
  /usr/bin/lsblk ix,
  /usr/bin/lspci mrix,
  /usr/sbin/lvm ix,
  /usr/sbin/lvs ix,
  /usr/sbin/pvs ix,
  /usr/bin/sed mrix,
  /usr/bin/sudo ix,
  /usr/bin/lscpu ix,
  /usr/bin/uname mrix,
  /usr/sbin/vgs ix,
  /usr/bin/xpu-smi mrix,
  /usr/libexec/sudo/libsudo_util.so.0.0.0 mr,
  /usr/libexec/sudo/sudoers.so mr,
  /usr/sbin/dmidecode mrix,
  /usr/sbin/ldconfig mrix,
  /usr/sbin/ldconfig.real mrix,
  /usr/sbin/smartctl ix,
  /var/lib/rasdaemon/ras-mc_event.db rk,
  /var/lib/smartmontools/drivedb/drivedb.h r,
  owner /dev/dri/by-path/ r,
  owner /dev/mei* rw,
  owner /dev/mem r,
  owner /root/.pciids-cache r,
  owner /run/systemd/userdb/ r,
  owner /run/systemd/userdb/io.systemd.DynamicUser rw,
  owner /sys/bus/ r,
  owner /sys/bus/**/ r,
  owner /sys/bus/pci/** r,
  owner /sys/class/ r,
  owner /sys/class/*/ r,
  owner /sys/firmware/dmi/** r,
  owner /sys/firmware/efi/systab r,
  owner /sys/fs/cgroup/cgroup.controllers r,
  owner /sys/fs/cgroup/system.slice/platform-observability-metrics.service/cpuset.cpus.effective r,
  owner /sys/fs/cgroup/system.slice/platform-observability-metrics.service/cpuset.mems.effective r,
  owner /sys/kernel/mm/hugepages/ r,
  owner /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages r,
  owner /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages r,
  owner /sys/module/i915/** r,
  owner /usr/share/misc/pci.ids r,

}
