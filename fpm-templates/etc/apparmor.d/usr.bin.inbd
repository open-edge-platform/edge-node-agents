# Last Modified: Wed Apr 16 09:26:26 2025
#include <tunables/global>

/usr/bin/inbd {
  #include <abstractions/base>
  #include <abstractions/bash>
  #include <abstractions/nameservice>

  capability chown,
  capability dac_override,
  capability fsetid,
  capability mac_admin,
  capability sys_ptrace,
  /bin/cat Pix,
  /usr/bin/cat Pix,
  /bin/chmod rix,
  /usr/bin/chmod rix,
  /bin/cp rix,
  /usr/bin/cp rix,
  /bin/grep rix,
  /usr/bin/grep rix,
  /bin/gzip rix,
  /bin/mkdir rix,
  /bin/mv rix,
  /usr/bin/mv rix,
  /bin/systemctl rUx,
  /usr/bin/systemctl rUx,
  /bin/tar rix,
  /bin/gzip rix,
  /bin/lsb_release rUx,
  /usr/bin/lsb_release rUx,
  /usr/bin/rpc rix,
  /usr/bin/tar rix,
  /usr/bin/gzip rix,
  /bin/uname rix,
  /usr/bin/uname rix,
  /bin/rm rix,
  /usr/bin/rm rix,
  /bin/ps rix,
  /usr/bin/ps rix,
  /usr/bin/os-update-tool.sh rix,
  /boot/efi/ rw,
  /boot/efi/** rw,
  /dev/mem r,
  /dev/mapper/ rw,
  /dev/mapper/** rw,
  /dev/tty rw,
  /etc/ r,
  /etc/intel-manageability/ rw,
  /etc/intel-manageability/** rw,
  /etc/dpkg/dpkg.cfg r,
  /etc/dpkg/dpkg.cfg.d/ r,
  /etc/dpkg/dpkg.cfg.d/* r,
  /etc/intel_edge_node/tokens/release-service/access_token r,
  /etc/intel_manageability.conf wr,
  /etc/firmware_tool_info.conf r,
  /etc/fstab r,
  /etc/opt/csl/csl-node/csl-manager r,
  /etc/opt/csl/csl-node/long-lived-token r,
  /etc/os-release r,
  /etc/image-id r,
  /etc/apt/sources.list rw,
  /etc/apt/sources.list.bak rw,
  /etc/apt/sources.list.d/* rw,
  /etc/apt/sources.list.d/ rw,
  /usr/bin/gpg rUx,
  /bin/gpg rUx,
  /var/intel-manageability/inbd_state rw,
  /etc/lsb-release r,
  /etc/magic r,
  /etc/mime.types r,
  /etc/ssl/certs/csl-ca-cert.pem r,
  /etc/ssl/certs/csl-ca-cert.crt r,
  /lib/systemd/system/ r,
  /lib/systemd/system/inbd.service rw,
  /usr/lib/systemd/system/ r,
  /usr/lib/systemd/system/inbd.service rw,
  /etc/task_list.yaml r,
  /opt/afulnx/afulnx_64 rUx,
  /usr/bin/afulnx_64 rUx,
  /proc/1/comm r,
  /proc/device-tree/firmware/bios/** r,
  /proc/*/mounts r,
  /proc/*/fd/ r,
  /proc/*/status r,
  /proc/sys/net/core/somaxconn r,
  /proc/sys/kernel/hostname r,
  /proc/sys/kernel/osrelease r,
  /run/docker.sock rw,
  /run/inbd.sock rw,
  /sbin/apparmor_parser rix,
  /sbin/ldconfig rix,
  /sbin/ldconfig.real rix,
  /sys/block/ r,
  /sys/class/hwmon/ r,
  /sys/devices/** r,
  /sys/firmware/dmi/tables/DMI r,
  /sys/firmware/dmi/tables/smbios_entry_point r,
  /sys/firmware/efi/systab r,
  /sys/firmware/efi/efivars/** w,
  /sys/kernel/mm/transparent_hugepage/hpage_pmd_size r,
  /sys/kernel/security/apparmor/ r,
  /sys/kernel/security/apparmor/* w,
  /sys/kernel/security/apparmor/features/ r,
  /sys/kernel/security/apparmor/features/** r,
  /tmp/ rw,
  /tmp/** mrw,
  /usr/bin/apt-get rUx,
  /usr/bin/mkdir rix,
  /usr/bin/do-release-upgrade rUx,
  /usr/bin/docker-compose rUx,
  /usr/bin/dpkg rUx,
  /usr/bin/dpkg-deb rUx,
  /usr/bin/dpkg-query rUx,
  /usr/bin/dpkg-split rUx,
  /usr/bin/ip rUx,
  /usr/bin/snapper rUx,
  /usr/bin/sudo rix,
  /usr/bin/tpm2 rUx,
  /usr/bin/truncate rUx,
  /usr/bin/umount rUx,
  /usr/bin/unrar rix,
  /usr/bin/unrar-nonfree rix,
  /usr/bin/UpdateBIOS.sh rix,
  /usr/bin/UpdateFirmwareBlobFwupdtool.sh rUx,
  /usr/bin/inbd rix,
  /usr/sbin/ip rUx,
  /var/intel-manageability/ rw,
  /var/intel-manageability/** rwk,
  /usr/local/bin/oras rix,
  /usr/sbin/aa-status rix,
  /usr/sbin/cryptsetup rUx,
  /usr/share/keyrings/*.gpg w,
  /usr/share/intel-manageability/** r,
  /usr/share/intel-manageability/* r,
  /usr/share/inbd_schema.json r,
  /usr/share/keyrings/ rw,
  /usr/share/keyrings/* rw,
  /var/cache/manageability/ rw,
  /var/cache/manageability/** rw,
  /var/intel-manageability r,
  /var/movisoc-fwu-status rw,
  /var/lib/dpkg/ r,
  /var/lib/dpkg/* l,
  /var/lib/dpkg/* wr,
  /var/lib/dpkg/info/ r,
  /var/lib/dpkg/info/* rwix,
  /var/lib/dpkg/lock k,
  /var/lib/dpkg/lock-frontend k,
  /var/lib/dpkg/tmp.ci/ rw,
  /var/lib/dpkg/tmp.ci/** rwix,
  /var/lib/dpkg/tmp.ci/preinst rix,
  /var/lib/dpkg/triggers/* rw,
  /var/lib/dpkg/triggers/Lock k,
  /var/lib/dpkg/updates/ rw,
  /var/lib/dpkg/updates/* rw,
  /var/local/intel-manageability/backups/version.txt r,
  /var/local/intel-manageability/backups/** w,
  /var/log/dpkg.log w,
  /var/log/inbm-update-status.log rw,
  /var/log/inbm-update-log.log rw,
  /var/log/apt/history.log r,
  /etc/ssl/openssl.cnf r,
  /usr/share/intel/managed/artifact_info r,
  /scripts/dmi_id_bios_info/* r,
  /usr/share/misc/magic.mgc r,
  /usr/bin/file rix,
  /usr/bin/file.file rix,
  /usr/sbin/chroot rUx,
  /usr/** r,
  /usr/bin/fwupdate rUx,
  /usr/bin/SblFwUpdate.py rUx,
}
